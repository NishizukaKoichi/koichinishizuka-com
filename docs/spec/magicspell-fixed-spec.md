# **MagicSpell 最終仕様書（Fixed Specification）**

## **0. この文書の役割（最重要）**

この文書は以下を固定するために存在する。

- MagicSpell が **何を解決し**
- **何を解決しないか**
- どこまでやれば **完成（Done）** と言えるか

将来像・夢・拡張案は一切含めない。
ここに書いていないものは **やらない**。

---

## **1. 価値定義（支払いが発生する瞬間）**

### **誰が**

- 個人開発者・小規模チーム
- 自作のアプリ／スクリプト／ツールを「売れる形」にしたい人

### **どの状況で**

- 機能は完成している
- だが「配布・課金・停止」を自前で作るのが重すぎる

### **何に困っているか**

- 売るたびに仕組みを作り直している
- 課金と実行がズレるのが怖い
- 解約・返金・事故対応が属人化している

### **なぜ今解決しないといけないか**

- AI/自動化で「作るコスト」は下がった
- **売る・止める・管理するコストだけが残っている**
- ここを解決しない限り量産できない

→ **MagicSpell は「作ったものを、安心して売るための OS」**

---

## **2. 課題 → 価値 → 支払い理由 対応表**

| **課題** | **MagicSpell の機能** | **なぜ払うのが合理的か** |
| --- | --- | --- |
| 課金と実行がズレる | Entitlement 中心設計 | 誤課金・無断利用を防げる |
| 解約時の挙動が不安 | Webhook-only + 即時剥奪 | トラブル対応コストが消える |
| 壊れた時に直せない | Reconcile | 人手復旧の恐怖が消える |
| 配布が怖い | Scope + Download Gate | 所有権を安全に売れる |
| 運用がブラックボックス | Audit / Ledger | 責任を説明できる |

---

## **3. MVP 機能定義（削れなかった理由付き）**

### **含めた機能**

- Entitlement 中心の実行ゲート  
  → 無いと「売ったのに止められない」
- Stripe Webhook-only 確定  
  → 戻りURL依存は破綻する
- Reconcile / Audit / Ledger  
  → 課金が絡む以上、復旧不能は致命傷
- Distribution / Download Gate  
  → ビルド済み成果物を商品にするため

### **後回しにしたもの**

- マルチ決済プロバイダ  
  → Entitlement があるため後付け可能
- 高度な分析 UI  
  → 行動ログが取れていれば後でよい

---

## **4. ユーザーフロー（行動固定）**

1. 未登録状態で価値を理解
2. 登録（最低限）
3. 初回利用（無料制限）
4. 制限にぶつかる
5. 課金を検討
6. 支払い完了（Webhook）
7. 即時アンロック
8. 再訪・再利用
9. 解約 → 即時ロック

※ UI ではなく **行動**を固定

---

## **5. 課金設計（お願いにしない）**

- 無料状態  
  → 実行はできるが「続けられない」
- 支払いで消える不確実性  
  → 止まらない / 失われない / 後で消されない
- 支払い後の判断コスト  
  → 「使っていいか？」を考えなくて済む

---

## **6. 非機能要件・運用前提**

- 可用性  
  → 実行ゲートが最優先、UI は次
- 障害時  
  → Entitlement が真実点
- 責任範囲  
  → MagicSpell は「権利管理」まで
- サポート  
  → 管理者操作・Reconcile まで

---

## **7. 実装仕様（技術翻訳）**

- 実行判定

```
if (!entitled) block
```

- 課金確定  
  → Stripe Webhook のみ
- 冪等性  
  → stripe_event_ledger
- 監査  
  → entitlement_audit_log
- 配布  
  → scope + token + download gate

---

## **8. 計測・観測（感覚を排除）**

- checkout_started
- checkout_completed
- entitlement_granted
- execute_after_payment
- execute_day1 / day7
- subscription_deleted

---

## **9. 課金後行動検証（Done 条件）**

Done と言えるのは以下すべて成立時のみ。

- Day0 実行あり
- Day1 再実行が過半数
- Day7 継続ユーザーが存在
- 即時キャンセルが例外的

---

## **10. 最終固定定義（これ以上削らない）**

> MagicSpell は  
> **作ったものを、壊さずに、売り、止め、説明できるための OS** である。

- テンプレとは独立
- アプリの中身は関知しない
- 売り方を縛らない
- 実行だけを制御する

---

## **結論**

**ここまでで MagicSpell は完成している。**

これ以降は：

- SKU を増やす
- 商品を増やす
- 売り方を変える

だけで、**仕様は一切増えない**。

つまり今後やることは  
**「作る」ではなく「使う」**。

ここまで来たら、もう設計フェーズは終わり。  
次に必要なのは **売るものを増やすこと**だけ。
